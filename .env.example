# Production Environment Configuration
# Copy this file to .env.production and fill in your production values
# Use ./utils/prod install to auto-generate secret keys
#
# This is for docker-compose.prod.yml deployment

################################################################################
# Instance Branding
################################################################################
# Service name displayed in UI header, emails, 2FA, and OAuth clients
# Example: illo.ink, MyIllo, My Art Community
INSTANCE_NAME=illo

# Tagline displayed in browser title (optional)
# Example: "Illustration Community SNS", "イラストコミュニケーションSNS"
# Browser title format: "INSTANCE_NAME - INSTANCE_TAGLINE" or "Page Title | INSTANCE_NAME"
INSTANCE_TAGLINE=

################################################################################
# Database (Docker Compose managed)
################################################################################
# NOTE: Database ports are NOT exposed to host by default for security.
# Internal Docker network is used for all database communication.
POSTGRES_USER=illustboard_user
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD
POSTGRES_DB=illustboard_db

# Database URL for Prisma (local development only)
# For production, this is set internally in docker-compose
DATABASE_URL=postgresql://illustboard_user:CHANGE_ME_STRONG_PASSWORD@localhost:5432/illustboard_db

################################################################################
# Redis (Docker Compose managed)
################################################################################
# NOTE: Redis port is NOT exposed to host by default for security.
REDIS_HOST=redis
REDIS_PORT=6379

################################################################################
# MinIO / S3 (Docker Compose managed)
################################################################################
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=CHANGE_ME_STRONG_PASSWORD
S3_BUCKET=illustboard
S3_REGION=us-east-1

# MinIO Console - Set to true to expose MinIO admin console on host
# Only needed for debugging or manual file management
EXPOSE_MINIO_CONSOLE=false
MINIO_CONSOLE_PORT=9001

# MinIO Public URL (for serving images through nginx)
# Should match your public BASE_URL
MINIO_PUBLIC_URL=https://your-domain.com

################################################################################
# Application URLs
################################################################################
# BASE_URL - Your instance's public URL (REQUIRED)
# This is used for ActivityPub federation and absolute URLs
BASE_URL=https://your-domain.com

# Frontend URL - Used by backend for CORS and redirects
# Usually same as BASE_URL
FRONTEND_URL=https://your-domain.com

# For production with nginx reverse proxy, use empty string
NUXT_PUBLIC_API_BASE=

################################################################################
# Instance Identification
################################################################################
# Unique identifier for this instance (used for cookie namespacing)
# Prevents session collision when accessing multiple instances
INSTANCE_ID=prod
NUXT_PUBLIC_INSTANCE_ID=prod

################################################################################
# Node Environment
################################################################################
PORT=11104
NODE_ENV=production

################################################################################
# JWT Authentication (REQUIRED)
################################################################################
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# Or use: ./utils/prod install
JWT_SECRET=CHANGE_ME_GENERATE_WITH_CRYPTO
JWT_EXPIRES_IN=7d

################################################################################
# Encryption Keys (REQUIRED)
################################################################################
# 2FA/TOTP secret encryption (AES-256-GCM)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=CHANGE_ME_GENERATE_WITH_CRYPTO

# Image encryption at rest (AES-256-GCM) - RECOMMENDED
# When set, images are encrypted in MinIO and served through API proxy
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
IMAGE_ENCRYPTION_KEY=CHANGE_ME_GENERATE_WITH_CRYPTO_FOR_IMAGES

# Message encryption at rest (AES-256-GCM) - RECOMMENDED for DM privacy
# When set, direct messages are encrypted in database
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
MESSAGE_ENCRYPTION_KEY=CHANGE_ME_GENERATE_WITH_CRYPTO_FOR_MESSAGES

################################################################################
# Image Security
################################################################################
# Hotlink Protection - Prevents direct image access from external sites
IMAGE_HOTLINK_PROTECTION=true
IMAGE_ALLOW_NO_REFERER=false
# Additional origins allowed to access images (comma-separated)
# IMAGE_ALLOWED_ORIGINS=https://trusted-domain.com

# Signed URLs - Time-limited cryptographic signatures for image URLs
# Stronger protection against URL sharing and caching attacks
IMAGE_SIGNED_URL_ENABLED=true
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
IMAGE_SIGNING_KEY=CHANGE_ME_GENERATE_WITH_CRYPTO_FOR_SIGNING
# URL expiration time in seconds (default: 90 = 1.5 minutes)
IMAGE_SIGNED_URL_EXPIRES=90

################################################################################
# Image Processing
################################################################################
# Maximum file size per image in MB
IMAGE_MAX_FILE_SIZE_MB=32
# Maximum total size for all images in a single upload (MB)
IMAGE_MAX_TOTAL_SIZE_MB=200
# Maximum number of images per artwork (NONE tier default, tier limits defined in code)
IMAGE_MAX_FILES_PER_ARTWORK=5
# Default maximum width for detail page display (pixels)
IMAGE_DEFAULT_MAX_WIDTH=2048
# Preserve original format (png, gif, webp, svg) instead of converting to JPEG
IMAGE_PRESERVE_FORMAT=true
# Embed copyright metadata (EXIF/IPTC/XMP) in images
IMAGE_EMBED_METADATA=true
# Support SVG format (requires @xmldom/xmldom)
IMAGE_SUPPORT_SVG=true

################################################################################
# Storage Quota
################################################################################
# Default storage quota per user (GB)
STORAGE_QUOTA_DEFAULT_GB=1
# Storage quota for admin users (GB)
STORAGE_QUOTA_ADMIN_GB=10
# Enforce storage quota (set to false for monitoring only)
STORAGE_QUOTA_ENFORCE=false

################################################################################
# Mail Configuration (SMTP)
################################################################################
SMTP_HOST=smtp.your-provider.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=your-smtp-username
SMTP_PASS=your-smtp-password
MAIL_FROM=noreply@your-domain.com

################################################################################
# Optional Features
################################################################################
# Bluesky OAuth integration
BLUESKY_OAUTH_ENABLED=true

# Bluesky OAuth JWKS Private Key (JWK format, auto-generated by install.sh)
# This key is used for OAuth token signing and must persist across restarts
# DO NOT manually edit - let install.sh generate this automatically
BLUESKY_OAUTH_PRIVATE_JWK=

################################################################################
# Patreon Integration (Monetization)
################################################################################
# Patreon OAuth credentials from https://www.patreon.com/portal/registration/register-clients
PATREON_CLIENT_ID=
PATREON_CLIENT_SECRET=
PATREON_REDIRECT_URI=https://your-domain.com/settings/patreon/callback
# Creator Access Token for webhook verification (get from Patreon Creator Portal)
PATREON_CREATOR_ACCESS_TOKEN=

################################################################################
# Instance Contact Information
################################################################################
# Contact information displayed to users (email, URL, or any text)
INSTANCE_CONTACT_INFO=admin@your-domain.com
# Admin username for direct contact link (without @)
INSTANCE_ADMIN_USERNAME=

################################################################################
# Nginx Reverse Proxy
################################################################################
# Port exposed to host (only used when SSL_ENABLED=false)
# When using Cloudflare Tunnel, this is only used for internal routing
NGINX_PORT=3000

################################################################################
# SSL Configuration
################################################################################
# Enable SSL termination in Docker nginx (HTTPS on 443, HTTP redirect on 80)
# When enabled:
# - nginx-ssl service is used (profile: ssl)
# - Requires SSL certificates at ./ssl/cert.pem and ./ssl/key.pem
# - Ports 80 and 443 are exposed to host
#
# When disabled (default):
# - nginx service is used (profile: http)
# - Only NGINX_PORT is exposed to host (HTTP only)
# - Use with Cloudflare Tunnel or external SSL termination
#
# For Cloudflare Origin Certificate:
# 1. Cloudflare Dashboard > SSL/TLS > Origin Server > Create Certificate
# 2. Save certificate to ./ssl/cert.pem and key to ./ssl/key.pem
# 3. Set SSL_ENABLED=true
SSL_ENABLED=false

################################################################################
# Cloudflare Tunnel (Alternative to SSL termination)
################################################################################
# Cloudflare Tunnel provides:
# - Free HTTPS/SSL certificate management (no SSL_ENABLED needed)
# - DDoS protection and Web Application Firewall
# - AI/Bot crawler blocking (free)
# - No need to expose ports to the internet
#
# When enabled:
# - Uses HTTP nginx (profile: http) - SSL handled by Cloudflare
# - cloudflared connects to nginx via Docker network
# - NGINX_PORT exposed to host for health checks only
#
# When disabled + SSL_ENABLED=false:
# - nginx exposes NGINX_PORT to the host (HTTP only)
# - Use external SSL termination (not recommended)
#
# When disabled + SSL_ENABLED=true:
# - nginx-ssl handles SSL termination directly
# - Ports 80/443 exposed to host
#
# Setup:
# 1. Go to Cloudflare Zero Trust Dashboard > Access > Tunnels
# 2. Create a new tunnel, copy the token (don't run the docker command)
# 3. Set CLOUDFLARE_TUNNEL_TOKEN below
# 4. In Cloudflare, configure Public Hostname:
#    - Hostname: your-domain.com
#    - Service Type: HTTP
#    - Service URL: nginx:80  (internal Docker network)
#
# Enable Cloudflare Tunnel (set to true to use)
CLOUDFLARE_TUNNEL_ENABLED=false

# Tunnel token from Cloudflare Zero Trust Dashboard
# Get this from: Zero Trust > Access > Tunnels > Create Tunnel > Docker
CLOUDFLARE_TUNNEL_TOKEN=

################################################################################
# Rate Limiting (Anti-Scraping)
################################################################################
# Enable measurement mode to collect baseline data without penalties
# Set to true during initial deployment to observe normal user patterns
RATE_LIMIT_MEASUREMENT_MODE=false

# Enable the new composite score algorithm (CV + interval analysis)
# Set to true to use the improved detection algorithm
RATE_LIMIT_USE_COMPOSITE_SCORE=false

# Score thresholds (0-100, only used when RATE_LIMIT_USE_COMPOSITE_SCORE=true)
# HARD_LIMIT: Complete block (default: 90, triggers on obvious automation)
# SOFT_LIMIT: Quality degradation (default: 50, triggers on suspicious patterns)
# WARNING: Log only (default: 35)
RATE_LIMIT_HARD_SCORE=90
RATE_LIMIT_SOFT_SCORE=50
RATE_LIMIT_WARNING_SCORE=35
